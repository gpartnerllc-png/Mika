<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Miquely Modas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root { --ws-green: #25D366; --ws-bg: #f0f2f5; }
        body { background-color: var(--ws-bg); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        /* Estilo Cartão Catálogo WhatsApp */
        .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .product-card:active { transform: scale(0.98); }
        
        .ws-header { background-color: #075E54; color: white; }
        .btn-pay { background-color: #000; color: white; display: flex; align-items: center; justify-content: center; gap: 8px; border-radius: 8px; font-weight: 600; transition: 0.3s; }
        .btn-pay:hover { background-color: #333; }
        
        /* Modal de Recibo */
        #receipt-modal { display: none; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .receipt-paper { background: white; border-radius: 2px; position: relative; padding: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .receipt-paper::after { content: ""; position: absolute; bottom: -10px; left: 0; width: 100%; height: 10px; background: linear-gradient(-45deg, white 5px, transparent 0), linear-gradient(45deg, white 5px, transparent 0); background-size: 10px 10px; }
    </style>
</head>
<body>

    <header class="ws-header sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="https://novidadesnaloja.moda/clientes/47149826000180_20240122230901.jpeg" class="w-10 h-10 rounded-full border border-white/20">
                <div>
                    <h1 class="font-bold text-lg leading-tight">Miquely Modas</h1>
                    <span class="text-xs text-green-300">● Online agora</span>
                </div>
            </div>
            <button onclick="toggleCart()" class="relative p-2">
                <i class="fa-solid fa-cart-shopping text-xl"></i>
                <span id="cart-count" class="absolute top-0 right-0 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold">0</span>
            </button>
        </div>
    </header>

    <div class="bg-white border-b px-4 py-2 text-center text-[11px] text-gray-500 font-medium uppercase tracking-wider">
        Mínimo para atacado: <span class="text-red-500 font-bold">R$ 700,00</span>
    </div>

    <main class="container mx-auto px-2 py-4 grid grid-cols-2 md:grid-cols-4 gap-3" id="catalog-container">
        </main>

    <div id="receipt-modal" class="fixed inset-0 z-[200] flex items-center justify-center p-4">
        <div class="receipt-paper w-full max-w-sm">
            <div class="text-center border-b border-dashed pb-4 mb-4">
                <h2 class="font-bold text-xl uppercase">Recibo de Pedido</h2>
                <p class="text-xs text-gray-400" id="receipt-date"></p>
            </div>
            <div id="receipt-items" class="space-y-2 text-sm mb-4 max-h-60 overflow-y-auto"></div>
            <div class="border-t border-dashed pt-4 mb-6">
                <div class="flex justify-between font-bold text-lg">
                    <span>TOTAL:</span>
                    <span id="receipt-total">R$ 0,00</span>
                </div>
            </div>
            
            <div class="space-y-3">
                <button onclick="initGooglePay()" class="btn-pay w-full py-3">
                    <i class="fa-brands fa-google-pay text-3xl"></i> Pagar Agora
                </button>
                
                <button onclick="finalizarWhatsApp()" class="w-full bg-[#25D366] text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2">
                    <i class="fa-brands fa-whatsapp"></i> Enviar Pedido no Whats
                </button>
                
                <button onclick="closeReceipt()" class="w-full text-gray-400 text-xs font-semibold py-2">CANCELAR</button>
            </div>
        </div>
    </div>

    <div id="cart-sidebar" class="fixed inset-y-0 right-0 w-full max-w-xs bg-white shadow-2xl z-[150] translate-x-full transition-transform duration-300 flex flex-col">
        <div class="p-4 ws-header flex justify-between items-center">
            <span class="font-bold">Minha Sacola</span>
            <button onclick="toggleCart()" class="text-white text-2xl">&times;</button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50"></div>
        <div class="p-4 border-t shadow-inner bg-white">
            <div class="flex justify-between font-bold mb-4">
                <span>Subtotal:</span>
                <span id="cart-total-value">R$ 0,00</span>
            </div>
            <button id="btn-pre-checkout" onclick="openReceipt()" class="w-full bg-black text-white py-4 rounded-xl font-bold uppercase text-xs tracking-widest disabled:opacity-30">
                Fechar Pedido
            </button>
        </div>
    </div>

    <script>
        const MARGEM = 1.50;
        const MIN_PEDIDO = 700;
        let cart = [];

        // Base de dados simplificada (usando os links que você enviou)
        const db = [
            { id: 'p1', name: 'Body Manga Longa', price: 125.90, img: 'https://imagens.viashopmoda.com.br/upload/Goiania_Intuicao/colecoes/30/20250820155538_intuicao3_67_e.jpg' },
            { id: 'v1', name: 'Conjunto Luxo 4132', price: 115.00, img: 'https://imagens.viashopmoda.com.br/upload/Goiania_Intuicao/colecoes/15/4132_(3)_ec.jpg' },
            { id: 'v2', name: 'Conjunto Renda 22506', price: 115.00, img: 'https://imagens.viashopmoda.com.br/upload/Goiania_Intuicao/colecoes/22/2022101311531022506_(6)_e.jpg' }
            // ... adicione os outros links aqui seguindo o padrão
        ];

        function renderCatalog() {
            const container = document.getElementById('catalog-container');
            db.forEach(prod => {
                const finalPrice = prod.price * MARGEM;
                container.innerHTML += `
                    <div class="product-card">
                        <img src="${prod.img}" class="w-full aspect-[3/4] object-cover">
                        <div class="p-3">
                            <h3 class="text-[11px] font-bold text-gray-700 truncate uppercase">${prod.name}</h3>
                            <p class="text-green-600 font-bold text-sm">R$ ${finalPrice.toFixed(2)}</p>
                            <button onclick="addToCart('${prod.name}', ${finalPrice}, '${prod.img}')" class="mt-2 w-full border border-green-500 text-green-600 py-1 rounded-md text-[10px] font-bold hover:bg-green-50">
                                ADICIONAR
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        function addToCart(name, price, img) {
            cart.push({name, price, img});
            updateCart();
            // Feedback visual rápido
            const count = document.getElementById('cart-count');
            count.classList.add('scale-150', 'bg-green-500');
            setTimeout(() => count.classList.remove('scale-150', 'bg-green-500'), 300);
        }

        function updateCart() {
            const list = document.getElementById('cart-items');
            const totalVal = document.getElementById('cart-total-value');
            const btn = document.getElementById('btn-pre-checkout');
            let total = 0;

            list.innerHTML = cart.length ? '' : '<p class="text-center text-gray-400 py-10">Sua sacola está vazia</p>';
            
            cart.forEach((item, i) => {
                total += item.price;
                list.innerHTML += `
                    <div class="flex gap-3 bg-white p-2 rounded-lg shadow-sm">
                        <img src="${item.img}" class="w-12 h-16 object-cover rounded">
                        <div class="flex-1">
                            <p class="text-[10px] font-bold">${item.name}</p>
                            <p class="text-sm font-bold text-green-600">R$ ${item.price.toFixed(2)}</p>
                        </div>
                        <button onclick="removeItem(${i})" class="text-red-400"><i class="fa-solid fa-trash-can"></i></button>
                    </div>
                `;
            });

            totalVal.innerText = `R$ ${total.toFixed(2)}`;
            document.getElementById('cart-count').innerText = cart.length;
            btn.disabled = total < MIN_PEDIDO;
        }

        function removeItem(i) { cart.splice(i, 1); updateCart(); }
        function toggleCart() { document.getElementById('cart-sidebar').classList.toggle('translate-x-full'); }

        // Sistema de Recibo e Pagamento
        function openReceipt() {
            const modal = document.getElementById('receipt-modal');
            const itemsCont = document.getElementById('receipt-items');
            const totalCont = document.getElementById('receipt-total');
            let total = 0;

            itemsCont.innerHTML = '';
            cart.forEach(item => {
                total += item.price;
                itemsCont.innerHTML += `
                    <div class="flex justify-between text-xs">
                        <span>${item.name}</span>
                        <span>R$ ${item.price.toFixed(2)}</span>
                    </div>`;
            });

            totalCont.innerText = `R$ ${total.toFixed(2)}`;
            document.getElementById('receipt-date').innerText = new Date().toLocaleString();
            modal.style.display = 'flex';
        }

        function closeReceipt() { document.getElementById('receipt-modal').style.display = 'none'; }

        // Simulação Google Pay (Payment Request API)
        async function initGooglePay() {
            if (window.PaymentRequest) {
                const supportedInstruments = [{ supportedMethods: 'basic-card' }]; // O Google Pay integra aqui
                const details = {
                    total: { label: 'Total Miquely Modas', amount: { currency: 'BRL', value: cart.reduce((a,b)=>a+b.price, 0).toFixed(2) } }
                };
                try {
                    const request = new PaymentRequest(supportedInstruments, details);
                    const response = await request.show();
                    await response.complete('success');
                    finalizarWhatsApp("PAGAMENTO PRÉ-APROVADO VIA GOOGLE PAY");
                } catch (e) {
                    alert("Pagamento cancelado ou não suportado no ambiente atual.");
                }
            } else {
                alert("Seu navegador não suporta Google Pay nativo.");
            }
        }

        function finalizarWhatsApp(status = "PENDENTE") {
            const fone = "5561983446343";
            let total = cart.reduce((a,b)=>a+b.price, 0).toFixed(2);
            let msg = `*RECIBO DE PEDIDO - MIQUELY MODAS*\n`;
            msg += `*Status:* ${status}\n`;
            msg += `------------------------------\n`;
            cart.forEach(item => msg += `• ${item.name} - R$ ${item.price.toFixed(2)}\n`);
            msg += `------------------------------\n`;
            msg += `*TOTAL: R$ ${total}*`;
            
            window.open(`https://api.whatsapp.com/send?phone=${fone}&text=${encodeURIComponent(msg)}`);
        }

        renderCatalog();
    </script>
</body>
</html>
